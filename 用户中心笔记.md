# 用户中心

---



## 一、用户中心（上）



### 企业做项目流程

需求分析 => 设计（概要设计、详细设计）=> 技术选型 => 

初始化 / 引入需要的技术 => 写 Demo => 写代码（实现业务逻辑） => 测试（单元测试）=> 代码提交 / 代码评审 => 部署=> 发布



### 需求分析

1. **登录 / 注册**
2. **用户管理（仅管理员可见）对用户的查询或者修改**
3. 用户校验（ **仅星球用户** ）



### 技术选型

前端：三件套 + React + 组件库 Ant Design + Umi + Ant Design Pro（现成的管理系统）

后端：

- java
- spring（依赖注入框架，帮助你管理 Java 对象，集成一些其他的内容）
- springmvc（web 框架，提供接口访问、restful接口等能力）
- mybatis（Java 操作数据库的框架，持久层框架，对 jdbc 的封装）
- mybatis-plus（对 mybatis 的增强，不用写 sql 也能实现增删改查）
- springboot（**快速启动** / 快速集成项目。不用自己管理 spring 配置，不用自己整合各种框架）
- junit 单元测试库
- mysql

部署：服务器 / 容器（平台）



### 项目初始化

1. 前端初始化

   1. Ant Design Pro 官方文档

   2. 通过包管理器安装依赖 终端——yarn命令
      yarn是包管理器

   3. 前端项目重要文件`package.json`
      其中存放 项目依赖目录 和 一些操作脚本

   4. `NodeJS`版本>18, 通过start脚本启动项目会报错
      ![image-20230506230010370]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230506230010370.png) 
      **解决方法1**：需要在start前加一个命令
      `"start_t": "set NODE_OPTIONS=\"--openssl-legacy-provider\" & npm run start\n"`
      将增加后的脚本添加到`package.json`
      终端输入`yarn start_t` 或者 `npm run start_t`  项目启动成功

      **解决方法2**：降低NodeJS版本到16
      
   5. 开启`Umi UI`(可选)
      `npm install --save-dev @umijs/preset-ui` 或  `yarn add @umijs/preset-ui -D`
      可以根据模板自动生成代码

      ![image-20230507001309304]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230507001309304.png)

   6. 项目瘦身
      移除国际化--执行脚本`i18n-remove`删除国际化相关组件

   7. 项目结构

      |     项目目录     |                作用                |
      | :--------------: | :--------------------------------: |
      |      config      | 存储⼀些配置(⽐如：本地代理、路由) |
      |       dist       |        已经编译好的项目目录        |
      |       mock       |      模拟的后台数据（假数据）      |
      |      public      |    一些静态资源（图标、图片等）    |
      |       src        |             源代码目录             |
      | services/app.tsx |             项目的入口             |

2. 后端初始化

   1. MySQL安装
      5.7版本 https://dev.mysql.com/downloads/installer/5.7.html
      8.0版本 https://dev.mysql.com/downloads/installer
      ——验证是否安装成功：使用idea内置的图形化工具连接

   2. 三种初始化 Java 项目的方式

      1. GitHub 搜现成的代码
      2. SpringBoot 官方的模板生成器（https://start.spring.io/）
      3. 直接在 IDEA 开发工具中生成  ✔

      如果要引入 java 的包，可以去 maven 中心仓库寻找（http://mvnrepository.com/）

   3. 引入mybatis-plus

      跟随快速开始官方文档 引入依赖 配置文件

      ```yaml
      #application.yml
      
      spring:
        #DataSourse Config
        datasource:
          driver-class-name: com.mysql.jdbc.Driver
          url: jdbc:mysql://localhost:3306/user-center
          username: root
          password: 111111
      ```

      

      ```java
      import com.example.usercenter.mapper.UserMapper;
      import com.example.usercenter.model.User;
      import org.junit.Assert;
      
      import org.junit.Test;
      import org.junit.jupiter.api.Test;
      import org.junit.runner.RunWith;
      import org.springframework.boot.test.context.SpringBootTest;
      import org.springframework.test.context.junit4.SpringRunner;
      
      import javax.annotation.Resource;
      import java.util.List;
      
      
      @SpringBootTest
      //3.空指针异常 没有自动注入 SpringBoot框架没启动
      //解决方法1：在测试类之前 加入@RunWith(SpringRunner.class)注解
      //解决方法2：@Test导入org.junit.jupiter.api.Test包
      //原因：该测试类不是默认测试类 因此不会启动SpringBoot框架
      @RunWith(SpringRunner.class)
      public class SampleTest {
      
          //1.对象注入失败：将测试类中自动注入的注解修改为@Resource
          //原因：Resource会默认按照Java的名称去注⼊属性，如果是Autowired的话，只会按照类型去注⼊属性，所以⼀般⽤Resource来⾃动注⼊
          @Resource
          private UserMapper userMapper;
      
          @Test
          public void testSelect() {
              System.out.println(("----- selectAll method test ------"));
              List<User> userList = userMapper.selectList(null);
              //2.assert不生效：需要引入junit依赖
              Assert.assertEquals(5, userList.size());
              userList.forEach(System.out::println);
          }
      
      }
      ```

      

   4. 引入依赖——去 maven 中心仓库寻找（http://mvnrepository.com/）
      选择用的人数多的 没有风险的版本





## 二、用户中心（中）

---





### 数据库设计

1. 数据库基础

   1. 什么是数据库？存数据的 
   2. 数据库里有什么？数据表（理解为 excel 表格） 
   3. java 操作数据库，代替人工 
   4. 什么是设计数据库表？ 
   5. 有哪些表（模型）？表中有哪些字段？字段的类型？数据库字段添加索引？
   6. 表与表之间的关联 
   7. 性别是否需要加索引？  不需要。区分度不大的字段没必要加索引。

2. 数据库创建 
   idea可视化工具创建数据库/SQL语句创建

   ![image-20230507175447264]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230507175447264.png)

   ```sql
   -- auto-generated definition
   create table user
   (
       id           bigint auto_increment comment 'id' primary key,
       username     varchar(256)                       null comment '用户昵称',
       userAccount  varchar(256)                       null comment '账号',
       avatarUrl    varchar(1024)                      null comment '用户头像',
       gender       tinyint                            null comment '性别',
       userPassword varchar(512)                       not null comment '密码',
       phone        varchar(128)                       null comment '电话',
       email        varchar(512)                       null comment '邮箱',
       userStatus   int      default 0                 not null comment '状态: 0 - 正常',
       createTime   datetime default CURRENT_TIMESTAMP not null comment '创建时间',
       updateTime   datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment '是否删除（逻辑删除）',
       isDelete     tinyint  default 0                 not null comment '是否删除'
   ) comment '用户表';
   ```



### 完成后端注册功能

1. 规整项目目录
   分层：controller、service、mapper/dao
   其他目录：model、utils

2. 实现基本数据库操作（操作user表）

   1. 创建模型User对象：和数据库表关联
      自动生成对象——mybatisX插件
      ![image-20230507190923050]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230507190923050.png)
      ![image-20230507191233415]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230507191233415.png)

      生成之后 搬运到自己的目录中

       MyBatisX 插件，自动根据数据库生成 domain 实体对象、mapper（操作数据库的对象）、mapper.xml（定义了 mapper对象和数据库的关联，可以在里面自己写 SQL）、service（包含常用的增删改查）、serviceImpl（具体实现 service）

   2. 对刚刚创建的代码进行测试——UserService.java中alt+enter创建测试类
      ![image-20230507191853552]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230507191853552.png)
      添加@SpringBootTest注解=>创建测试方法、导入Test包=>注入UserService对象=>添加数据——使用插件![image-20230507192757674]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230507192757674.png)

   3. ```java
      //测试代码 UserServiceTest.java
      import com.example.usercenter.model.domain.User;
      import org.junit.jupiter.api.Test;
      import org.springframework.boot.test.context.SpringBootTest;
      
      import javax.annotation.Resource;
      
      import static org.junit.jupiter.api.Assertions.*;
      
      /**
       * 用户服务测试
       */
      @SpringBootTest
      public class UserServiceTest {
      
         @Resource
         private UserService userService;
      
         @Test
         public void testAddUser() {
            User user = new User();
            user.setUsername("testUserName");
            user.setUserAccount("123456");
            user.setAvatarUrl("https://aaaabbbccc.jpg");
            user.setGender(0);
            user.setUserPassword("123456");
            user.setPhone("123123123");
            user.setEmail("123123123");
      
            boolean result = userService.save(user);
            System.out.println(user.getId());
            assertTrue(result);
            //通过assert断言 测试程序的执行结果
         }
      }
      ```

      测试失败原因：数据库和实体类中命名都是驼峰，但mybatis-plus插件自动打开了下划线转换驼峰的配置
      ![image-20230507194043013]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230507194043013.png)
      解决方法：在配置文件中添加配置

      ```yml
      mybatis-plus:
        configuration:
          map-underscore-to-camel-case: false
      ```

      测试成功 成功向数据库中添加了一条数据

3. 注册逻辑

   1. 用户在前端输入账户和密码、以及校验码（todo）
   2. 校验用户的账户、密码、重复密码，是否符合要求
      - 非空 
      - 账户长度 不小于 4 位
      - 密码 不小于 8 位 
      - 账户不能重复
      - 账户不包含特殊字符 
      - 密码和校验密码相同
   3. 对密码加密（密码千万不要直接以明文存储到数据库中）
   4. 向数据库插入用户数据

4. 注册功能实现
   用到工具类——Apache Commons Lang，在mvnrepository中找到并引入

   ```java
   package com.example.usercenter.service.impl;
   
   
   import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
   import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
   import com.example.usercenter.mapper.UserMapper;
   import com.example.usercenter.model.domain.User;
   import com.example.usercenter.service.UserService;
   
   import org.apache.commons.lang3.StringUtils;
   import org.springframework.stereotype.Service;
   import org.springframework.util.DigestUtils;
   
   import javax.annotation.Resource;
   import java.util.regex.Matcher;
   import java.util.regex.Pattern;
   
   /**
    * 用户服务实现类
    *
    * @author Cora
    * @description 针对表【user(用户表)】的数据库操作Service实现
    * @createDate 2023-05-07 19:12:26
    */
   @Service
   public class UserServiceImpl extends ServiceImpl<UserMapper, User>
   		implements UserService {
   
   	@Resource
   	private UserMapper userMapper;
   
   	@Override
   	public long userRegister(String userAccount, String userPassword, String checkPassword) {
   		//1.校验 使用Apache Commons Lang工具类判空
   		//非空
   		if (StringUtils.isAnyBlank(userAccount, userPassword, checkPassword)) {
   			return -1;
   		}
   
   		//账户长度 不小于 4 位
   		if (userAccount.length() < 4) {
   			return -1;
   		}
   
   		//密码 不小于 8 位
   		if (userPassword.length() < 8 || checkPassword.length() < 8) {
   			return -1;
   		}
   
   
   		//账户不包含特殊字符 正则表达式
   		String validRule = "[`~!@#$%^&*()+=|{}':;',\\\\[\\\\].<>/?~！@#￥%…… &*（）——+|{}【】‘；：”“’。，、？]";
   		Matcher matcher = Pattern.compile(validRule).matcher(userAccount);
   		// 如果包含非法字符，则返回 -1
   		if (matcher.find()) {
   			return -1;
   		}
   
   
   		//密码和校验密码相同
   		if (!userPassword.equals(checkPassword)) {
   			return -1;
   		}
   
   		//账号不能重复(这里可以优化执行顺序 将查询数据库操作放到最后一步)
   		//查询数据库
   		QueryWrapper<User> userQueryWrapper = new QueryWrapper<>();
   		userQueryWrapper.eq("userAccount", userAccount);
   		long count = userMapper.selectCount(userQueryWrapper);
   		//如果已经被注册
   		if (count > 0) {
   			return -1;
   		}
   
   		//2.对密码进行加密
   		final String SALT = "salt";
   		String encryptedPassword = DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());
   
   		//3.向数据库中插入数据
   		User user = new User();
   		user.setUserAccount(userAccount);
   		user.setUserPassword(encryptedPassword);
   
   		boolean saveResult = this.save(user);
   		//返回值判空
   		if (!saveResult) {
   			return -1;
   		}
   
   		return user.getId();
   	}
   }
   ```

   

5. 注册功能测试
   创建测试类 通过assert断言 依次测试每一条规则

   ```java
   package com.example.usercenter.service;
   
   
   import com.example.usercenter.model.domain.User;
   import org.junit.jupiter.api.Assertions;
   import org.junit.jupiter.api.Test;
   import org.springframework.boot.test.context.SpringBootTest;
   
   import javax.annotation.Resource;
   
   import static org.junit.jupiter.api.Assertions.*;
   
   /**
    * 用户服务测试
    */
   @SpringBootTest
   public class UserServiceTest {
   
   	@Resource
   	private UserService userService;
   
      	/**
   	 * 用户注册功能测试
   	 */
   	@Test
   	void userRegister() {
   		//测试非空
   		String userAccount = "cora";
   		String userPassword = "";
   		String checkPassword = "";
   		long result = userService.userRegister(userAccount, userPassword, checkPassword);
   		Assertions.assertEquals(-1, result);
   
   		//测试账户长度 不小于 4 位
   		userAccount = "aa";
   		userPassword = "12345678";
   		checkPassword = "12345678";
   		result = userService.userRegister(userAccount, userPassword, checkPassword);
   		Assertions.assertEquals(-1, result);
   
   		//测试密码 不小于 8 位
   		userAccount = "cora";
   		userPassword = "1234";
   		checkPassword = "1234";
   		result = userService.userRegister(userAccount, userPassword, checkPassword);
   		Assertions.assertEquals(-1, result);
   
   		//测试账户不包含特殊字符
   		userAccount = "co ra";
   		userPassword = "12348888";
   		checkPassword = "12348888";
   		result = userService.userRegister(userAccount, userPassword, checkPassword);
   		Assertions.assertEquals(-1, result);
   
   		//测试密码和校验密码相同
   		userAccount = "cora";
   		userPassword = "12348888";
   		checkPassword = "12349999";
   		result = userService.userRegister(userAccount, userPassword, checkPassword);
   		Assertions.assertEquals(-1, result);
   
   		//测试账号不能重复
   		userAccount = "cora";
   		userPassword = "12348888";
   		checkPassword = "12348888";
   		result = userService.userRegister(userAccount, userPassword, checkPassword);
   		Assertions.assertEquals(-1, result);
   
   		//测试 向数据库中插入数据成功 返回新用户id
   		userAccount = "coraInsert";
   		userPassword = "88888888";
   		checkPassword = "88888888";
   		result = userService.userRegister(userAccount, userPassword, checkPassword);
   		Assertions.assertTrue(result > 0);
   
   
   	}
   }
   ```

   ![image-20230508212659839]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230508212659839.png)

   测试通过，注册功能完成



## 三、用户中心（下）

---





### 完成后端登录功能

1. 登录接口
   接受参数：用户账户、密码
   请求类型：post
   请求体：JSON
   返回值：用户信息（注意脱敏）

2. 登录逻辑

   1. 校验用户名密码是否合法

      1. 非空 
      2. 账户长度 不小于 4 位
      3. 密码 不小于 8 位 
      4. 账户不包含特殊字符 

   2. 对密码进行加密

   3. 查询数据库 判断用户名密码是否存在->再判断密码（加密后）是否正确
      问题：数据库中被逻辑删除的行也会被查出来
      解决方法：配置mybatis-plus逻辑删除
      ![image-20230513235610109]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230513235610109.png)

      

   4. 用户信息脱敏

   5. 记录用户的登录态（session），将其存到服务器上（用后端 SpringBoot 框架封装的服务器 tomcat 去记录）

      ------如何知道是哪个用户登录了？（javaweb 这一块）

      1. 连接服务器端后，得到一个 session 状态（匿名会话），返回给前端

      2. 登录成功后，得到了登录成功的 session，并且给该sessio n设置一些值（比如用户信息），返回给前端一个设置 cookie 的 ”命令“ 

         **session => cookie** 

      3. 前端接收到后端的命令后，设置 cookie，保存到浏览器内

      4. 前端再次请求后端的时候（相同的域名），在请求头中带上cookie去请求

      5. 后端拿到前端传来的 cookie，找到对应的 session

      6. 后端从 session 中可以取出基于该 session 存储的变量（用户的登录信息、登录名）

   6. 返回脱敏后的用户信息

```java
	@Override
	public User userLogin(String userAccount, String userPassword, HttpServletRequest request) {
		//1.校验 使用Apache Commons Lang工具类判空
		//非空
		if (StringUtils.isAnyBlank(userAccount, userPassword)) {
			return null;
		}

		//账户长度 不小于 4 位
		if (userAccount.length() < 4) {
			return null;
		}

		//密码 不小于 8 位
		if (userPassword.length() < 8) {
			return null;
		}

		//账户不包含特殊字符 正则表达式
		String validRule = "[`~!@#$%^&*()+=|{}':;',\\\\[\\\\].<>/?~！@#￥%…… &*（）——+|{}【】‘；：”“’。，、？]";
		Matcher matcher = Pattern.compile(validRule).matcher(userAccount);
		// 如果包含非法字符，则返回null
		if (matcher.find()) {
			return null;
		}

		//2.对密码进行加密
		String encryptedPassword = DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());

		//3.查询数据库
		//判断用户名密码是否存在->再判断密码（加密后）是否正确
		QueryWrapper<User> userQueryWrapper = new QueryWrapper<>();
		userQueryWrapper.eq("userAccount", userAccount);
		userQueryWrapper.eq("userPassword", encryptedPassword);
		User user = userMapper.selectOne(userQueryWrapper);
		if (user == null) {
			//用户不存在/用户名密码不匹配
			log.info("user login failed: userAccount cannot match userPassword");
			return null;
		}


		//4.用户信息脱敏
		User safetyUser = new User();
		safetyUser.setId(user.getId());
		safetyUser.setUsername(user.getUsername());
		safetyUser.setUserAccount(user.getUserAccount());
		safetyUser.setAvatarUrl(user.getAvatarUrl());
		safetyUser.setGender(user.getGender());
		safetyUser.setPhone(user.getPhone());
		safetyUser.setEmail(user.getEmail());
		safetyUser.setUserStatus(user.getUserStatus());
		safetyUser.setCreateTime(user.getCreateTime());

		//5.记录用户的登录态
		request.getSession().setAttribute(USER_LOGIN_STATE, safetyUser);

		return safetyUser;
	}
```



### 完成后端用户登录注册接口



- @RestController注解 适用于编写 restful 风格的 api，返回值默认为 json 类型
  ![image-20230514000635784]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230514000635784.png)

- 自动填充方法参数插件
  ![image-20230514005220877]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230514005220877.png)

- 创建用户注册/登录请求体

  ```java
  package com.example.usercenter.model.domain.request;
  
  import lombok.Data;
  
  import java.io.Serializable;
  
  /**
   * 用户注册请求体
   */
  @Data
  public class UserRegisterRequest implements Serializable {
  
  	//这里没有生成序列化 可能会有问题
  
  	private String userAccount;
  	private String userPassword;
  	private String checkPassword;
  }
  ```

  

- 完成Controller层校验(仅对参数本身校验 不涉及业务逻辑)

  ```java
  package com.example.usercenter.controller;
  
  import com.example.usercenter.model.domain.User;
  import com.example.usercenter.model.domain.request.UserLoginRequest;
  import com.example.usercenter.model.domain.request.UserRegisterRequest;
  import com.example.usercenter.service.UserService;
  import org.apache.commons.lang3.StringUtils;
  import org.springframework.web.bind.annotation.*;
  
  import javax.annotation.Resource;
  import javax.servlet.http.HttpServletRequest;
  import java.util.List;
  
  @RestController
  @RequestMapping("/user")
  public class UserController {
  
  	@Resource
  	private UserService userService;
  
  	/**
  	 * 用户注册接口
  	 * @param userRegisterRequest 实体类 包含三个属性
  	 * @return 新注册的用户ID
  	 */
  	@PostMapping("/register")
  	public Long userRegister(@RequestBody UserRegisterRequest userRegisterRequest) {
  		if (userRegisterRequest == null) {
  			return null;
  		}
  
  		String userAccount = userRegisterRequest.getUserAccount();
  		String userPassword = userRegisterRequest.getUserPassword();
  		String checkPassword = userRegisterRequest.getCheckPassword();
  
  		if (StringUtils.isAnyBlank(userAccount, userPassword, checkPassword)) {
  			return null;
  		}
  
  		long id = userService.userRegister(userAccount, userPassword, checkPassword);
  		return id;
  	}
  
  	/**
  	 * 用户登录接口
  	 * @param userLoginRequest 实体类 包含两个属性
  	 * @param request
  	 * @return 脱敏后的用户信息
  	 */
  	@PostMapping("/login")
  	public User userLogin(@RequestBody UserLoginRequest userLoginRequest, HttpServletRequest request) {
  		if (userLoginRequest == null) {
  			return null;
  		}
  
  		String userAccount = userLoginRequest.getUserAccount();
  		String userPassword = userLoginRequest.getUserPassword();
  
  		if (StringUtils.isAnyBlank(userAccount, userPassword)) {
  			return null;
  		}
  
  		User user = userService.userLogin(userAccount, userPassword, request);
  		return user;
  	}
  }
  ```

- 测试接口
  ![image-20230514020245068]( https://cora-typora-test-2023.oss-cn-shanghai.aliyuncs.com/pics/image-20230514020245068.png)
  测试成功，用户登录注册接口完成



### 用户管理接口

注意必须鉴权：给数据表加一个字段userRole 默认值0-普通用户 1-管理员
同时需要用mybatisX插件重新生成代码 重新给isDelete加上@TableLogic注解

1. 根据用户名查询用户

2. 删除用户

   ```java
   //将常量放到常量类中
   package com.example.usercenter.constant;
   
   /**
    * 用户常量
    */
   public interface UserConstant {
   	/**
   	 * 用户登录态键
   	 */
   	String USER_LOGIN_STATE = "userLoginState";
   
   	// ---权限---
   	/**
   	 * 默认权限
   	 */
   	int DEFAULT_ROLE = 0;
   
   	/**
   	 * 管理员权限
   	 */
   	int ADMIN_ROLE = 1;
   }
   
   ```

   

   ```java
   /**
   	 * 根据用户昵称查询用户
   	 * @param userName 用户昵称
   	 * @return 查询到的List<User>
   	 */
   	@GetMapping("/search")
   	public List<User> searchUsers(String userName, HttpServletRequest request) {
   		//仅管理员可查询
   		if(!isAdmin(request)) {
   			return new ArrayList<>();
   		}
   
   		//根据用户昵称查询
   		//这里利用mybatis-plus的模糊查询方法
   		//代码比较简单 就不放到service层了
   		QueryWrapper<User> wrapper = new QueryWrapper<>();
   		if(!StringUtils.isAnyBlank(userName)) {
   			wrapper.like("username", userName);
   		}
   		List<User> userList = userService.list(wrapper);
   		//用户信息脱敏
   		return userList.stream().map(user -> userService.getSafetyUser(user)).collect(Collectors.toList());
   	}
   
   	/**
   	 * 根据ID删除用户
   	 * @param id 用户ID
   	 * @return 是否成功删除
   	 */
   	@DeleteMapping
   	public boolean deleteUser(@RequestBody long id, HttpServletRequest request) {
   		//仅管理员可查询
   		if(!isAdmin(request)) {
   			return false;
   		}
   
   		if (id <= 0) {
   			log.info("要删除的ID非法");
   			return false;
   		}
   		//已经做了逻辑删除配置
   		//因此只需要调用mybatis-plus的删除就可以，会自动转换
   		return userService.removeById(id);
   	}
   
   
   
   	/**
   	 * 鉴权 判断是否为管理员请求
   	 * @param request http请求
   	 * @return 布尔值 是否为管理员
   	 */
   	private boolean isAdmin(HttpServletRequest request) {
   		//鉴权 判断是否为管理员请求
   		//提取session中的用户信息
   		User user = (User) request.getSession().getAttribute(USER_LOGIN_STATE);
   		//如果是非管理员用户 返回false
   		if(user.getUserRole() != ADMIN_ROLE) {
   			log.info("非管理员权限访问");
   			return false;
   		}
   
   		log.info("管理员权限访问");
   		return true;
   	}
   
   ```

   测试成功，根据昵称查询用户 和 根据id删除用户 接口 完成







